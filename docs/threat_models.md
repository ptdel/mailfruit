# What threat models does `mailfruit` attempt to address?

Also check out the [design decisions](design_decisions.md) document.

`mailfruit` is designed to address specific threat models. It's helpful to understand that the Dovecot `trees` plugin encrypts emails using the user's IMAP password (this is actually a lot more complicated, but for these models this explaination will do.)

## Anna, the casual email user
Anna wants to keep her personal email private from advertisers that host free email services. She can use this to set up a personal mail server on a virtual machine hosted by a third party; by being her own email provider, her emails will not be used to sell products to her. Her hosting provider has full access to her RAM and has the ability to read her password, however she does not care about this vulnerability - she simply wants to stop being spammed with ads.

## Alex, the paranoid sysadmin
Alex has concerns about the physical security of their mail server; their servers live in a colocated datacenter in a shared rack, and Alex doesn't know their neighbors at all. Alex can install `mailfruit` to ease the deployment of a secure mail server into this environment. However, Alex also uses an encrypted volume for `/var/mail` to prevent a casual black hat neighbor from powering off the machine in the rack, booting into single user mode, and running Dovecot themselves to collect passwords when users log in. This datacenter has pretty reliable power, so the machine is unlikely to restart by itself. However, if it does Alex will need to log into their server and remount the encrypted volume. Alex has set up good monitoring (or has noisy users) to alert them when this is necessary. Alex should consider if their threat model includes other physical hardening techniques, such as monitoring for case intrusion or epoxying all ports that allow Direct Memory Access (Thunderbolt, FireWire, PCI (/Express), etc.) Alex does not care if the world knows they're running a mail server or consider their ISP a threat.

## Mohammed, the political activist
Mohammed lives in a country that does not tolerate political dissidents and also really doesn't like the king. Not only is he concerned about server tampering like Alex, he also wants to prevent being identified as the owner of this email server and prevent the server from being seized. He hardens his installation like Alex does, but has a second server that lives outside his nation. He uses this second server to proxy SMTP traffic destined for his mail server over Tor to hidden services hosted by his `mailfruit` installation. He sets up these hidden services himself, as well as setting up a Tor bridge to prevent identification; with these configurations, he sets `manage_tor` to `false` to prevent `mailfruit` from configuring Tor in an unsafe fashion. He additionally implements much tighter firewall rules: no traffic is allowed to enter or leave the mailserver except Tor. He reads and sends mail using the SUBMISSION and IMAP hidden services. There are a lot of potential security holes with this configuration: 

* Moe should ensure Dovecot & Postfix cannot leak information about the server's location
* He should ensure that the Tor proxy server or DNS do not leak information about his identity (through WHOIS or payment information)
* He should use certificate pinning to protect against man-in-the-middle attacks at the Tor proxy
* .. and much more.

Moe's use case is an extreme one; luckily, Moe is an information security professional and can implement these controls with some work. However, if Moe was not educated about these risks and mitigations, he could easily make mistakes setting this server up that could be life-threatening. It's honestly unclear if `mailfruit` & the above hardening techniques are enough to completely protect Moe, so he carefully considers his actions and makes a decision for himself whether he can properly lock down his servers and tolerate the risks associated with running this service. `mailfruit` cannot and will not make any guarantees of safety for this threat model, but it does help Moe set up a reasonably secure mail server with Dovecot and Postfix without having in-depth knowledge on how to configure them - he can simply focus on hardening.
